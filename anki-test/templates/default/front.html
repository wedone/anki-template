<!-- æ­£é¢æ¨¡æ¿ -->
<div class="math-card">
    <div class="question-content answer-box" style="font-weight: normal;">
      {{#Image}}
      <div class="question-image">
        {{Image}}
      </div>
      {{/Image}}
      
      <div class="question-text math-content">{{Question}}</div>
    </div>
    
    <div class="card-footer">
      {{#Diff}}
      <div class="badge small-text">
        éš¾åº¦: 
        <span style="color: #e74c3c;" id="diffDisplay">
          {{Diff}}
        </span>
      </div>
      {{/Diff}}
      
      <!-- æ ‡ç­¾æ˜¾ç¤º -->
      {{#tag}}
      <div class="badge small-text">ğŸ·ï¸: {{tag}}
      </div>
      {{/tag}}
      
      <div id="settingsButton" onclick="toggleSettingsModal()">
        <span class="badge small-text" style="cursor: pointer;">âš™ï¸ è®¾ç½®</span>
      </div>
    </div>
    
    {{#Hint}}
    <div class="hint" onclick="this.classList.toggle('revealed')">
      æç¤º: <span class="hint-text">{{Hint}}</span>
    </div>
    {{/Hint}}
    
    <!-- è®¾ç½®å¼¹çª— -->
    <div id="settingsModal" class="settings-modal">
      <div class="settings-modal-content" style="width:320px;max-width:90%;top:24px;position:absolute;left:50%;transform:translateX(-50%);">
        <div class="settings-modal-header" style="padding-bottom:8px;">
          <h3 style="font-size:18px;margin:0;">å¡ç‰‡è®¾ç½®</h3>
          <span class="close-button" onclick="toggleSettingsModal()">&times;</span>
        </div>
        <div class="settings-modal-body" style="padding:12px;">
          <div class="setting" style="display:flex;align-items:center;gap:12px;margin-bottom:8px;">
            <label style="white-space:nowrap;width:80px;">å­—ä½“å¤§å°</label>
            <input type="range" min="12" max="24" value="18" id="fontSizeSlider" style="width:180px;">
            <span id="fontSizeValue" style="width:40px;text-align:right;">18px</span>
          </div>
          <div class="setting" style="display:flex;align-items:center;gap:12px;margin-bottom:8px;">
            <label style="white-space:nowrap;width:80px;">è¡Œé—´è·</label>
            <input type="range" min="13" max="20" value="15" id="lineHeightSlider" style="width:180px;">
            <span id="lineHeightValue" style="width:40px;text-align:right;">1.5</span>
          </div>
          <button onclick="applyDefaultSettings()" style="margin-top:8px;">æ¢å¤é»˜è®¤</button>
        </div>
      </div>
    </div>
  </div>
  
  <script>
  // æ›´æ–°éš¾åº¦æ˜¾ç¤º
  function updateDiffStars() {
    const display = document.getElementById('diffDisplay');
    if (display) {
      const level = parseInt(display.textContent);
      let stars = '';
      switch(level) {
        case 1: stars = 'â˜…â˜†â˜†â˜†â˜†'; break;
        case 2: stars = 'â˜…â˜…â˜†â˜†â˜†'; break;
        case 3: stars = 'â˜…â˜…â˜…â˜†â˜†'; break;
        case 4: stars = 'â˜…â˜…â˜…â˜…â˜†'; break;
        case 5: stars = 'â˜…â˜…â˜…â˜…â˜…'; break;
        default: stars = level;
      }
      display.textContent = stars;
    }
  }
  
  // è®¾ç½®åŠŸèƒ½
  window.frontSettings = {
    fontSize: 18,
    lineHeight: 1.5
  };
  
  // ä¿å­˜è®¾ç½®åˆ°localStorage
  function saveSettings() {
    try {
      localStorage.setItem('ankiCardSettings', JSON.stringify(window.frontSettings));
    } catch (e) {
      console.warn('æ— æ³•ä¿å­˜è®¾ç½®åˆ°localStorage:', e);
    }
  }
  
  // ä»localStorageåŠ è½½è®¾ç½®
  function loadSettings() {
    try {
      const savedSettings = localStorage.getItem('ankiCardSettings');
      if (savedSettings) {
        const parsed = JSON.parse(savedSettings);
        window.frontSettings = {
          fontSize: parsed.fontSize || 16,
          lineHeight: parsed.lineHeight || 1.5
        };
        return true;
      }
    } catch (e) {
      console.warn('æ— æ³•ä»localStorageåŠ è½½è®¾ç½®:', e);
    }
    return false;
  }
  
  function toggleSettingsModal() {
    const modal = document.getElementById('settingsModal');
    if (modal.classList.contains('show')) {
      modal.classList.remove('show');
    } else {
      modal.classList.add('show');
      // åŠ è½½å½“å‰è®¾ç½®åˆ°æ»‘å—
      document.getElementById('fontSizeSlider').value = window.frontSettings.fontSize;
      document.getElementById('lineHeightSlider').value = window.frontSettings.lineHeight * 10;
      updateSettingsDisplay();
    }
  }
  
  function updateSettings() {
    window.frontSettings.fontSize = parseInt(document.getElementById('fontSizeSlider').value);
    window.frontSettings.lineHeight = parseInt(document.getElementById('lineHeightSlider').value) / 10;
    
    updateSettingsDisplay();
    applySettings();
    // ä¿å­˜è®¾ç½®
    saveSettings();
  }
  
  function updateSettingsDisplay() {
    document.getElementById('fontSizeValue').textContent = window.frontSettings.fontSize + 'px';
    document.getElementById('lineHeightValue').textContent = window.frontSettings.lineHeight;
  }
  
  function applySettings() {
    document.documentElement.style.setProperty('--base-font-size', `${window.frontSettings.fontSize}px`);
    document.documentElement.style.setProperty('--line-height', window.frontSettings.lineHeight);
  }
  
  function applyDefaultSettings() {
    window.frontSettings.fontSize = 16;
    window.frontSettings.lineHeight = 1.5;
    document.getElementById('fontSizeSlider').value = 16;
    document.getElementById('lineHeightSlider').value = 15;
    updateSettings();
    // ä¿å­˜é»˜è®¤è®¾ç½®
    saveSettings();
  }
  
  // åˆå§‹åŒ–å‡½æ•°
  function initFront() {
    // åŠ è½½ä¿å­˜çš„è®¾ç½®
    loadSettings();
    
    // æ›´æ–°éš¾åº¦æ˜¾ç¤º
    updateDiffStars();
    
    // åˆå§‹åŒ–è®¾ç½®
    document.getElementById('fontSizeSlider').addEventListener('input', updateSettings);
    document.getElementById('lineHeightSlider').addEventListener('input', updateSettings);
    
    // åº”ç”¨è®¾ç½®
    applySettings();
    
    // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­æ¨¡æ€æ¡†
    window.addEventListener('click', function(event) {
      const modal = document.getElementById('settingsModal');
      if (event.target === modal) {
        modal.classList.remove('show');
      }
    });
    
    // æ¸²æŸ“æ•°å­¦å…¬å¼
    MathJax.typesetPromise().catch(console.error);
  }
  
  // MathJax é…ç½®
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']]
    },
    options: {
      enableMenu: false
    }
  };
  
  // æ‰§è¡Œåˆå§‹åŒ–
  setTimeout(initFront, 50);
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script> 