<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>数学问答模板预览工具</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background: #f7f7f7; margin: 0; padding: 0; }
        .main-container { max-width: 1200px; margin: 30px auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 12px #0002; padding: 30px 40px; }
        .section { margin-bottom: 32px; }
        .section-title { font-size: 1.2em; font-weight: bold; margin-bottom: 10px; color: #1976d2; }
        .flex-row { display: flex; gap: 32px; }
        .flex-col { display: flex; flex-direction: column; gap: 16px; }
        textarea { width: 100%; min-height: 80px; font-family: monospace; font-size: 1em; border-radius: 6px; border: 1px solid #ccc; padding: 8px; }
        .field-label { font-weight: bold; margin-bottom: 2px; }
        .field-input { width: 100%; padding: 6px; border-radius: 4px; border: 1px solid #bbb; font-size: 1em; }
        .preview-switch { margin-bottom: 16px; }
        .preview-area { background: #f9f9f9; border-radius: 8px; min-height: 320px; padding: 24px; border: 1px solid #e0e0e0; }
        .file-btn { margin-left: 8px; }
        @media (max-width: 900px) {
            .main-container { padding: 10px; }
            .flex-row { flex-direction: column; gap: 16px; }
        }
    </style>
</head>
<body>
<div class="main-container">
    <div class="section">
        <div class="section-title">1. 粘贴或导入模板和样式</div>
        <div class="flex-row">
            <div style="flex:1">
                <div class="field-label">正面模板 front.html</div>
                <textarea id="frontTpl" placeholder="粘贴 front.html 代码"></textarea>
                <input type="file" accept=".html" onchange="loadFile(this, 'frontTpl')" class="file-btn">
            </div>
            <div style="flex:1">
                <div class="field-label">背面模板 back.html</div>
                <textarea id="backTpl" placeholder="粘贴 back.html 代码"></textarea>
                <input type="file" accept=".html" onchange="loadFile(this, 'backTpl')" class="file-btn">
            </div>
            <div style="flex:1">
                <div class="field-label">样式 style.css</div>
                <textarea id="cssTpl" placeholder="粘贴 style.css 代码"></textarea>
                <input type="file" accept=".css" onchange="loadFile(this, 'cssTpl')" class="file-btn">
            </div>
        </div>
    </div>
    <div class="section">
        <div class="section-title">2. 输入字段内容</div>
        <div class="flex-row">
            <div class="flex-col" style="flex:1">
                <label class="field-label">Question</label>
                <input class="field-input" id="field-Question" placeholder="题目内容，支持LaTeX">
                <label class="field-label">Answer</label>
                <input class="field-input" id="field-Answer" placeholder="最终答案">
                <label class="field-label">Diff（难度 1-5）</label>
                <input class="field-input" id="field-Diff" placeholder="如 3">
            </div>
            <div class="flex-col" style="flex:1">
                <label class="field-label">tag（标签）</label>
                <input class="field-input" id="field-tag" placeholder="如 一元二次方程">
                <label class="field-label">Hint（提示）</label>
                <input class="field-input" id="field-Hint" placeholder="如 可因式分解">
                <label class="field-label">Image（图片URL）</label>
                <input class="field-input" id="field-Image" placeholder="图片链接，可为空">
            </div>
        </div>
    </div>
    <div class="section">
        <div class="section-title">3. 预览</div>
        <div class="preview-switch">
            <label><input type="radio" name="previewType" value="front" checked onchange="renderPreview()"> 正面</label>
            <label style="margin-left:24px;"><input type="radio" name="previewType" value="back" onchange="renderPreview()"> 背面</label>
            <button onclick="renderPreview()" style="margin-left:32px;">刷新预览</button>
        </div>
        <div class="preview-area" id="previewArea"></div>
    </div>
</div>
<script>
// 读取文件内容到textarea
function loadFile(input, targetId) {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        document.getElementById(targetId).value = e.target.result;
        renderPreview();
    };
    reader.readAsText(file, 'utf-8');
}
// 获取所有字段内容
function getFields() {
    return {
        Question: document.getElementById('field-Question').value,
        Answer: document.getElementById('field-Answer').value,
        Diff: document.getElementById('field-Diff').value,
        tag: document.getElementById('field-tag').value,
        Hint: document.getElementById('field-Hint').value,
        Image: document.getElementById('field-Image').value
    };
}
// 简单 Mustache 替换
function renderTemplate(tpl, fields) {
    return tpl.replace(/\{\{#(\w+)}}([\s\S]*?)\{\{\/(\w+)}}/g, function(match, key, inner, endKey) {
        if(fields[key]) return inner.replace(new RegExp('\\{\\{' + key + '\\}\}', 'g'), fields[key]);
        else return '';
    }).replace(/\{\{(\w+)}}/g, function(match, key) {
        return fields[key] || '';
    });
}
// 渲染预览
function renderPreview() {
    const previewType = document.querySelector('input[name="previewType"]:checked').value;
    const frontTpl = document.getElementById('frontTpl').value;
    const backTpl = document.getElementById('backTpl').value;
    const cssTpl = document.getElementById('cssTpl').value;
    const fields = getFields();
    let html = '';
    let style = '';
    if(cssTpl) style = `<style>${cssTpl}</style>`;
    if(previewType === 'front') {
        html = renderTemplate(frontTpl, fields);
    } else {
        // 背面模板可能用到 {{FrontSide}}，先渲染正面
        let frontHtml = renderTemplate(frontTpl, fields);
        html = renderTemplate(backTpl.replace(/\{\{FrontSide}}/g, frontHtml), fields);
    }
    document.getElementById('previewArea').innerHTML = style + html;
    if(window.MathJax) MathJax.typesetPromise();
}
// 字段输入时自动刷新预览
Array.from(document.querySelectorAll('.field-input')).forEach(input => {
    input.addEventListener('input', renderPreview);
});
// 模板和样式输入时自动刷新预览
['frontTpl','backTpl','cssTpl'].forEach(id => {
    document.getElementById(id).addEventListener('input', renderPreview);
});
</script>
</body>
</html>
