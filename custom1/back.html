{{FrontSide}}
<div class="math-card">
  
  {{#Answer}}
  <div class="answer-box" style="font-weight: normal;">
    <div class="section-title" style="margin: 4px 0;">最终答案</div>
    <div class="math-content">{{Answer}}</div>
  </div>
  {{/Answer}}
  
  {{#Steps}}
  <div class="steps-container">
    <div class="section-title">解题步骤</div>
    <div id="stepsContent"></div>
  </div>
  {{/Steps}}
  
  {{#KeyConcept}}
  <div class="concept-box">
    <div class="section-title" style="margin: 4px 0;">核心概念</div>
    <div class="math-content">{{KeyConcept}}</div>
  </div>
  {{/KeyConcept}}
  
  {{#Formula}}
  <div class="formula-box">
    <div class="section-title" style="margin: 4px 0;">关键公式</div>
    <div class="math-content">{{Formula}}</div>
  </div>
  {{/Formula}}
  
  {{#CommonMistakes}}
  <div class="mistake-box">
    <div class="section-title" style="margin: 4px 0;">易错警示</div>
    <ul class="mistake-list" id="mistakesList"></ul>
  </div>
  {{/CommonMistakes}}
</div>


<script>
// 步骤处理函数 - 直接显示所有步骤
function processSteps() {
  const stepsContent = document.getElementById('stepsContent');
  if (!stepsContent) return; // 只需判断元素是否存在即可
  
  const steps = "{{Steps}}".split("||");
  stepsContent.innerHTML = '';
  steps.forEach((step) => {
    const stepElement = document.createElement('div');
    stepElement.className = 'step';
    stepElement.innerHTML = `
      <div class="step-content" style="display: block;">
        <div class="math-content">${step}</div>
      </div>
    `;
    stepsContent.appendChild(stepElement);
  });
}

// 易错点处理
function processMistakes() {
  const mistakesList = document.getElementById('mistakesList');
  if (!mistakesList) return;
  
  const mistakesData = "{{CommonMistakes}}";
  if (!mistakesData) return;
  
  const mistakes = mistakesData.split("|");
  mistakesList.innerHTML = '';
  
  mistakes.forEach(mistake => {
    if (mistake.trim()) {
      const li = document.createElement('li');
      li.textContent = mistake;
      mistakesList.appendChild(li);
    }
  });
}

// 应用设置函数
function applySettings() {
  // 从localStorage加载设置
  let frontSettings = window.frontSettings;
  if (!frontSettings) {
    try {
      const savedSettings = localStorage.getItem('ankiCardSettings');
      if (savedSettings) {
        const parsed = JSON.parse(savedSettings);
        frontSettings = {
          fontSize: parsed.fontSize || 16,
          lineHeight: parsed.lineHeight || 1.5,
        };
      } else {
        frontSettings = { fontSize: 16, lineHeight: 1.5 };
      }
    } catch (e) {
      console.warn('无法从localStorage加载设置:', e);
      frontSettings = { fontSize: 16, lineHeight: 1.5 };
    }
  }
  
  document.documentElement.style.setProperty('--base-font-size', `${frontSettings.fontSize}px`);
  document.documentElement.style.setProperty('--line-height', frontSettings.lineHeight);
}

// 初始化函数
function initBack() {
  // 处理内容
  processSteps();
  processMistakes();
  
  // 应用设置
  applySettings();
  
  // 渲染数学公式
  MathJax.typesetPromise().catch(console.error);
}

// 执行初始化
setTimeout(initBack, 50);
</script>
